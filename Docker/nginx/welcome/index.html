<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description"
        content="Sistema de Gestión Portuaria — Gestión eficiente de muelles, buques y servicios portuarios">
    <title>Gestorinaitor 3000 — Sistema de Gestión Portuaria</title>
    <link rel="stylesheet" href="./index.css">
</head>

<body>
    <!-- Hero -->
    <header class="hero">
        <img src="./Logo.jpg" alt="Gestorinaitor 3000" class="hero-logo">
        <h1>Sistema de Gestión Portuaria</h1>
        <p>Gestión eficiente de muelles, buques y servicios portuarios</p>
        <nav class="hero-actions" aria-label="Acceso a la aplicación">
            <a href="/login" class="btn btn-white">Iniciar Sesión</a>
            <a href="/register" class="btn btn-outline-white">Registrarse</a>
        </nav>
    </header>

    <!-- Estadísticas -->
    <main>
        <div class="container">
            <div class="stats" id="stats" role="region" aria-label="Estadísticas del puerto" aria-live="polite">
                <div class="loading">Cargando estadísticas…</div>
            </div>

            <!-- Reseñas -->
            <section class="reviews-section" aria-labelledby="resenas-title">
                <h2 id="resenas-title">Reseñas de Nuestros Clientes</h2>
                <div id="reviews" aria-live="polite">
                    <div class="loading">Cargando reseñas…</div>
                </div>
            </section>
        </div>
    </main>

    <footer class="site-footer">
        <p>&copy; 2026 Gestorinaitor 3000 — Sistema de Gestión Portuaria</p>
    </footer>

    <script>
        // Fetch statistics
        fetch('/api/estadisticas')
            .then(response => response.json())
            .then(data => {
                const statsHtml = `
                    <div class="stat-card">
                        <h3>${data.total_muelles}</h3>
                        <p>Muelles</p>
                    </div>
                    <div class="stat-card">
                        <h3>${data.total_buques}</h3>
                        <p>Buques</p>
                    </div>
                    <div class="stat-card">
                        <h3>${data.total_servicios}</h3>
                        <p>Servicios</p>
                    </div>
                    <div class="stat-card">
                        <h3>${data.promedio_calificacion || 'N/A'}</h3>
                        <p>Calificación Promedio</p>
                    </div>
                `;
                document.getElementById('stats').innerHTML = statsHtml;
            })
            .catch(error => {
                console.error('Error loading statistics:', error);
                document.getElementById('stats').innerHTML = '<div class="loading">Error al cargar estadísticas</div>';
            });

        // Fetch reviews
        fetch('/api/resenas/aprobadas')
            .then(response => response.json())
            .then(data => {
                const resenas = data.data || [];

                if (resenas.length === 0) {
                    document.getElementById('reviews').innerHTML = '<div class="loading">No hay reseñas disponibles</div>';
                    return;
                }

                const reviewsHtml = resenas.map(resena => {
                    const stars = '★'.repeat(resena.calificacion) + '☆'.repeat(5 - resena.calificacion);
                    const fecha = new Date(resena.fecha_resena).toLocaleDateString('es-ES');
                    const author = resena.user?.perfil?.nombre || resena.user?.name || 'Usuario';
                    const serviceInfo = resena.servicio ? `Servicio: ${resena.servicio.nombre} — ` : '';

                    return `
                        <article class="review-card">
                            <div class="review-header">
                                <span class="review-author">${author}</span>
                                <span class="review-rating" aria-label="${resena.calificacion} de 5 estrellas">${stars}</span>
                            </div>
                            <div class="review-service">${serviceInfo}${fecha}</div>
                            <div class="review-comment">${resena.comentario}</div>
                        </article>
                    `;
                }).join('');

                document.getElementById('reviews').innerHTML = reviewsHtml;
            })
            .catch(error => {
                console.error('Error loading reviews:', error);
                document.getElementById('reviews').innerHTML = '<div class="loading">Error al cargar reseñas</div>';
            });
    </script>
</body>

</html>